---
import "../styles/global.css";
import Counter from "../components/Counter.svelte";
// import ContactForm from "../components/ContactForm.svelte";
import { getCollection } from "astro:content";


interface Project { title: string; href?: string; tech?: string[] }

// Choose API base: use env, else localhost in dev, else no API
const API =
  import.meta.env.PUBLIC_API_URL ??
  (import.meta.env.DEV ? "http://localhost:8000" : undefined);

let projects: Project[] = [];

// Try API first (guarded so a failure doesn't crash the page)
if (API) {
  try {
    const r = await fetch(`${API}/api/projects`);
    if (r.ok) projects = await r.json();
  } catch {
    projects = [];
  }
}

// Fallback to content collection if API missing/unavailable
if (projects.length === 0) {
  const entries = await getCollection("projects");
  projects = entries.map((e) => ({
    title: e.data.title,
    href: `/projects/${e.slug}`,
    tech: e.data.tech,
  }));
}

// const B = import.meta.env.BASE_URL;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Sivan Syed - Portfolio</title>
    <meta name="description" content="Physics & ECE @ UT Austin • Robotics, controls, and systems." />
    <meta property="og:title" content="Sivan Syed - Portfolio" />
    <meta property="og:description" content="Physics & ECE @ UT Austin • Robotics, controls, and systems." />
    <meta property="og:image" content={`/og.png`} />
    <link rel="icon" href={`/favicon.svg`} />
  </head>
  <body class="mx-auto max-w-3xl p-6">
    <header class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <img src={`/favicon.svg`} alt="Logo" class="size-10" />
        <div>
          <h1 class="text-3xl font-bold">Sivan Syed</h1>
          <p class="opacity-80">Physics & ECE • Robotics • Controls • Systems</p>
        </div>
      </div>
      <nav class="text-sm">
        <a class="underline" href={`/projects`}>Projects</a>
        <a class="underline ml-3" href={`/now`}>/now</a>
        <a class="underline ml-3" href={`/uses`}>/uses</a>
        <a class="underline ml-3" href={`/contact`}>Contact</a>
      </nav>
    </header>

    <section class="mt-8">
      <h2 class="text-xl font-semibold">Interactive demo</h2>
      <Counter client:load />
    </section>

    <section class="mt-8">
      <div class="mt-4">
        <a class="underline" href={`/projects`}>See all projects →</a>
      </div>
    </section>

    <!-- <section id="contact" class="mt-12 border rounded-2xl p-4">
      <h2 class="text-xl font-semibold">Contact</h2>
      <ContactForm client:load apiBase={API} />
    </section> -->
  </body>
</html>
